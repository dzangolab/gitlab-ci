.buildx:
  teardown:
    - docker buildx rm multiplatform
  setup:
    - docker run --privileged --rm tonistiigi/binfmt --install all
    - docker buildx create --use --driver docker-container --name multiplatform
    - docker buildx inspect multiplatform --bootstrap
  build:
    - DOCKER_BUILDKIT=1 docker buildx build
        $[[ build-args]]
        --target production
        --platform $DOCKER_PLATFORMS
        --provenance=false
        --push
        -t $[[ image ]]
        -f $[[ dockerfile ]] .
    - docker manifest inspect $[[ image ]]
